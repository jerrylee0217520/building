<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>佳元松江社區 樓層互動資訊看板</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- 引入 Tailwind CSS for responsive and modern styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* 自定義滾動條樣式 */
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #f0f4f8;
    }
    ::-webkit-scrollbar-thumb {
      background: #c5d0d8;
      border-radius: 4px;
    }
    /* 全域樣式 */
    html, body {
      margin: 0; padding: 0;
      background: linear-gradient(135deg, #eef2f8, #d9e2ec); /* 柔和的漸層背景 */
      font-family: 'Noto Sans TC','Microsoft JhengHei',sans-serif;
      color: #333;
      overflow-x: hidden; /* 避免水平捲軸 */
    }
    /* 3D 背景容器 */
    #three-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        opacity: 0.7;
    }
    /* 建築物外觀圖容器 */
    .bldg-bg-wrap {
      width: 96vw;
      max-width: 700px;
      aspect-ratio: 1536/1024;
      margin: 18px auto 0 auto;
      background: url('jiayuansongjiang_building2.png') no-repeat bottom center;
      background-size: contain;
      position: relative;
      box-shadow: 0 4px 25px rgba(0,0,0,0.1); border-radius: 18px;
    }
    /* 樓層熱區的覆蓋層 */
    .bldg-overlay {
      position: absolute; left: 0; top: 0; width: 100%; height: 100%;
      pointer-events: none;
    }
    /* 樓層熱區 */
    .floor-zone {
      position: absolute; left: 0; width: 100%;
      opacity: 0.08; background: #26c6da; border-radius: 10px;
      pointer-events: auto;
      cursor: pointer;
      transition: opacity .2s, transform 0.2s;
      border: 2px solid transparent;
    }
    .floor-zone.active, .floor-zone:hover {
      opacity: 0.16; border: 2px solid #0288d1;
      transform: scale(1.01);
    }
    /* 樓層標籤 */
    .floor-label {
      position: absolute; left: 10px;
      font-size: max(1.5vw, 16px);
      color: #222; font-weight: bold; text-shadow: 0 1px 7px #fff8;
      z-index: 10; pointer-events: none;
    }
    @media (max-width: 700px) {
      .bldg-bg-wrap { width: 98vw; max-width: 98vw; }
      .floor-label { font-size: max(3vw, 14px); left: 6px; }
    }
    /* 住戶卡片區塊 */
    .floor-section { margin: 24px 0 0 0; }
    .floor-title {
        font-size: 24px;
        font-weight: bold;
        text-align: center;
        color: #000;
        margin: 0 0 16px 0;
    }
    .unit-row-wrap { overflow-x: auto; padding: 0 2vw 7px 2vw; box-sizing: border-box; }
    .unit-row { 
        display: flex; gap: 13px; 
        min-width: fit-content;
    }
    .unit-card { 
        flex: 0 0 auto;
        width: 220px; /* 增加卡片寬度 */
        background: #fff; border-radius: 18px; 
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        padding: 16px;
        display: flex; flex-direction: column; 
        align-items: flex-start; 
        margin-bottom: 0; 
        transition: box-shadow .3s, transform 0.3s ease-out;
        position: relative;
        animation: fadeIn 0.5s ease-out forwards; /* 卡片進場動畫 */
    }
    .unit-card:hover { 
        box-shadow: 0 8px 25px rgba(0,0,0,0.15); 
        transform: translateY(-8px);
    } 
    /* 狀態標籤 */
    .status-tag { 
        display: inline-block; 
        font-size: 14px; font-weight: 600; 
        color: #fff; border-radius: 13px; 
        padding: 4px 13px; 
        margin-bottom: 7px; letter-spacing: 1px;
    }
    .unit-header { 
        font-size: 20px; font-weight: bold; 
        margin-bottom: 4px; color: #2d3a4b; 
    }
    .owner-label { 
        font-size: 15px; color: #333; 
        margin-bottom: 2px; 
    }
    .resident-label { 
        font-size: 14px; color: #888; 
        margin-bottom: 5px; 
    }
    .row { 
        font-size: 13px; color: #444; 
        margin-bottom: 3px; 
    }
    /* 詳細資訊區塊 */
    .details-wrap {
      display: grid;
      grid-template-rows: 0fr;
      transition: grid-template-rows 0.3s ease-out;
    }
    .details-wrap.expanded {
      grid-template-rows: 1fr;
    }
    .details {
      overflow: hidden;
      margin-top: 10px;
      border-top: 1px dashed #d1d1d1;
      padding-top: 10px;
    }
    /* 按鈕樣式 */
    .toggle-btn { 
        background: #f0f4f8;
        color: #555; 
        border: 1px solid #ccc;
        border-radius: 20px;
        font-size: 13px;
        padding: 6px 16px;
        margin-top: 8px;
        cursor: pointer; 
        transition: all .2s;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .toggle-btn:hover {
        background: #e0e5ea;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .toggle-btn:active { background: #d0d5dc; }
    /* 卡片進場動畫 */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
  <div id="three-bg"></div>
  <h2 class="text-3xl font-bold text-center text-gray-800 my-4" style="text-shadow: 0 0 10px rgba(255,255,255,0.7);">佳元松江社區 樓層互動資訊看板</h2>
  <div class="bldg-bg-wrap" id="bldgWrap">
    <div class="bldg-overlay" id="bldgOverlay"></div>
  </div>
  <div id="floordatawrap" class="px-2 sm:px-4">
    <div class="floor-section">
      <h3 class="floor-title" id="currentfloor"></h3>
      <div class="unit-row-wrap"><div class="unit-row" id="floorunits"></div></div>
    </div>
  </div>
  <footer class="text-center text-gray-500 text-sm mt-8 pb-4">
    © 佳元松江2025
  </footer>
  <script>
    // =========================================================================
    // 資料維護區塊 (Data Maintenance Section)
    // 未來如果要更新住戶的資料，只需要修改下方這個 `allUnitData` 陣列即可。
    // 這個陣列中的每個物件都代表一個住戶單元。
    // =========================================================================
    const allUnitData = [
      { "戶別": "10A-10樓", "所有權人": "蔡政隆", "居住人": "尚未登記", "裝修公司": "質采室內裝修", "裝修人電話": "0289518898", "開工日": "2025/07/21", "預計完工": "2025-11-28", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "已開工", "車位": "無車位", "門牌地址": "松江路252巷10號10樓" },
      { "戶別": "10B-10樓", "所有權人": "梁本郁", "居住人": "尚未登記", "裝修公司": "優舍  高宇賢", "裝修人電話": "0922311253", "開工日": "2025/06/23", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "已開工", "車位": "B2-05", "門牌地址": "松江路252巷10號10樓之1" },
      { "戶別": "9A-9樓", "所有權人": "黃雅玲", "居住人": "尚未登記", "裝修公司": "玳爾室內設計", "裝修人電話": "0953627927", "開工日": "2025/06/18", "預計完工": "2025-10-22", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "已開工", "車位": "B2/13", "門牌地址": "松江路252巷10號9樓" },
      { "戶別": "9B-9樓", "所有權人": "張美華", "居住人": "尚未登記", "裝修公司": "楊智斌", "裝修人電話": "尚未登記", "開工日": "2025/07/08", "預計完工": "2025-09-30", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "已開工", "車位": "B2-09", "門牌地址": "松江路252巷10號9樓之1" },
      { "戶別": "8A-8樓", "所有權人": "黃誼僑", "居住人": "尚未登記", "裝修公司": "尚未登記", "裝修人電話": "尚未登記", "開工日": "尚未登記", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "未施工", "車位": "B2/08", "門牌地址": "松江路252巷10號8樓" },
      { "戶別": "8B-8樓", "所有權人": "佘雪紅", "居住人": "尚未登記", "裝修公司": "尚未登記", "裝修人電話": "尚未登記", "開工日": "尚未登記", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "未施工", "車位": "無車位", "門牌地址": "松江路252巷10號8樓之1" },
      { "戶別": "7A-7樓", "所有權人": "魏均穎", "居住人": "尚未登記", "裝修公司": "芬格室內裝修", "裝修人電話": "02-87878057", "開工日": "2025/06/25", "預計完工": "2025-08-15", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "已開工", "車位": "B2/01", "門牌地址": "松江路252巷10號7樓" },
      { "戶別": "7B-7樓", "所有權人": "尹衍嵐", "居住人": "尚未登記", "裝修公司": "尚未登記", "裝修人電話": "尚未登記", "開工日": "尚未登記", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "未施工", "車位": "無車位", "門牌地址": "松江路252巷10號7樓之1" },
      { "戶別": "7C-7樓", "所有權人": "黃怡瑋", "居住人": "尚未登記", "裝修公司": "劉經寰", "裝修人電話": "0910228955", "開工日": "2025/03/30", "預計完工": "2025-05-31", "驗退日期": "2025-06-19", "驗退狀態": "已驗收（6月19日)", "施工狀態": "已開工", "車位": "無車位", "門牌地址": "松江路252巷10號7樓之2" },
      { "戶別": "7D-7樓", "所有權人": "李佳芳", "居住人": "歐家瑋", "裝修公司": "自裝簡裝", "裝修人電話": "02-88113300", "開工日": "2025/07/29", "預計完工": "2025-07-29", "驗退日期": "2025-07-29", "驗退狀態": "已驗收（7月29日)", "施工狀態": "已開工", "車位": "無車位", "門牌地址": "松江路252巷10號7樓之3" },
      { "戶別": "7E-7樓", "所有權人": "王楷皓", "居住人": "尚未登記", "裝修公司": "尚未登記", "裝修人電話": "尚未登記", "開工日": "尚未登記", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "未施工", "車位": "無車位", "門牌地址": "松江路252巷10號7樓之5" },
      { "戶別": "7F-7樓", "所有權人": "游斯涵", "居住人": "尚未登記", "裝修公司": "鼎極室內裝修", "裝修人電話": "02-86681911", "開工日": "2025/07/10", "預計完工": "2025-09-05", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "已開工", "車位": "無車位", "門牌地址": "松江路252巷10號7樓之6" },
      { "戶別": "6A-6樓", "所有權人": "李苾琳", "居住人": "尚未登記", "裝修公司": "尚未登記", "裝修人電話": "尚未登記", "開工日": "尚未登記", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "未施工", "車位": "無車位", "門牌地址": "松江路252巷10號6樓" },
      { "戶別": "6B-6樓", "所有權人": "莊春陽", "居住人": "尚未登記", "裝修公司": "莊春陽", "裝修人電話": "0932255349", "開工日": "2025/07/11", "預計完工": "尚未登記", "驗退日期": "2025-07-23", "驗退狀態": "已驗收（7月23日)", "施工狀態": "已開工", "車位": "B2-06", "門牌地址": "松江路252巷10號6樓之1" },
      { "戶別": "6C-6樓", "所有權人": "蘇傳欽", "居住人": "尚未登記", "裝修公司": "尚未登記", "裝修人電話": "尚未登記", "開工日": "尚未登記", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "未施工", "車位": "無車位", "門牌地址": "松江路252巷10號6樓之2" },
      { "戶別": "6D-6樓", "所有權人": "黃薇芝", "居住人": "尚未登記", "裝修公司": "尚未登記", "裝修人電話": "尚未登記", "開工日": "尚未登記", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "未施工", "車位": "B2-02", "門牌地址": "松江路252巷10號6樓之3" },
      { "戶別": "6E-6樓", "所有權人": "兒玉勝行", "居住人": "尚未登記", "裝修公司": "尚未登記", "裝修人電話": "尚未登記", "開工日": "尚未登記", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "未施工", "車位": "無車位", "門牌地址": "松江路252巷10號6樓之5" },
      { "戶別": "6F-6樓", "所有權人": "陳品妤", "居住人": "尚未登記", "裝修公司": "巢藝設計", "裝修人電話": "02-22760115", "開工日": "2025/07/23", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "未施工", "車位": "無車位", "門牌地址": "松江路252巷10號6樓之6" },
      { "戶別": "5A-5樓", "所有權人": "仇沛珊", "居住人": "尚未登記", "裝修公司": "黃韶瑋", "裝修人電話": "0988075121", "開工日": "2025/06/16", "預計完工": "2025-07-08", "驗退日期": "2025-07-09", "驗退狀態": "已驗收（7月9日)", "施工狀態": "已開工", "車位": "無車位", "門牌地址": "松江路252巷10號5樓" },
      { "戶別": "5B-5樓", "所有權人": "優舍室內裝修", "居住人": "尚未登記", "裝修公司": "優舍  高宇賢", "裝修人電話": "0922311253", "開工日": "2025/07/09", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "已開工", "車位": "無車位", "門牌地址": "松江路252巷10號5樓之1" },
      { "戶別": "5C-5樓", "所有權人": "王子嫣", "居住人": "尚未登記", "裝修公司": "曾士華", "裝修人電話": "0922819918", "開工日": "2025/07/01", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "已開工", "車位": "B2-14", "門牌地址": "松江路252巷10號5樓之2" },
      { "戶別": "5D-5樓", "所有權人": "張甄庭", "居住人": "尚未登記", "裝修公司": "曾士華", "裝修人電話": "0922819918", "開工日": "2025/06/24", "預計完工": "2025-07-29", "驗退日期": "2025-07-29", "驗退狀態": "已驗收（7月29日)", "施工狀態": "已開工", "車位": "無車位", "門牌地址": "松江路252巷10號5樓之3" },
      { "戶別": "5E-5樓", "所有權人": "劉禹秀", "居住人": "尚未登記", "裝修公司": "尚未登記", "裝修人電話": "尚未登記", "開工日": "尚未登記", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "未施工", "車位": "B2-07", "門牌地址": "松江路252巷10號5樓之5" },
      { "戶別": "5F-5樓", "所有權人": "楊淑如", "居住人": "尚未登記", "裝修公司": "邱聖凱", "裝修人電話": "0936042827", "開工日": "2025/07/01", "預計完工": "2025-08-20", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "已開工", "車位": "無車位", "門牌地址": "松江路252巷10號5樓之6" },
      { "戶別": "4A-4樓", "所有權人": "蕭承昕", "居住人": "尚未登記", "裝修公司": "優舍  高宇賢", "裝修人電話": "0922311253", "開工日": "2025/07/02", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "已開工", "車位": "無車位", "門牌地址": "松江路252巷10號4樓" },
      { "戶別": "4B-4樓", "所有權人": "鄭美蘭", "居住人": "尚未登記", "裝修公司": "優舍  高宇賢", "裝修人電話": "0922311253", "開工日": "2025/07/02", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "已開工", "車位": "B2-03", "門牌地址": "松江路252巷10號4樓之1" },
      // 更新 4CD-4樓 的資料
      { "戶別": "4CD-4樓", "所有權人": "張雅婷", "居住人": "蔡資恆", "裝修公司": "蔡資恆", "裝修人電話": "0968081890", "開工日": "2025/08/04", "預計完工": "2025-09-30", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "已開工", "車位": "無車位", "門牌地址": "松江路252巷10號4樓之2" },
      { "戶別": "4EF-4樓", "所有權人": "李宛儒", "居住人": "尚未登記", "裝修公司": "李元亨", "裝修人電話": "0918391967", "開工日": "2025/06/25", "預計完工": "2025-09-30", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "已開工", "車位": "B2-04", "門牌地址": "松江路252巷10號4樓之5" },
      { "戶別": "3A-3樓", "所有權人": "張儷瑭", "居住人": "尚未登記", "裝修公司": "尚未登記", "裝修人電話": "尚未登記", "開工日": "尚未登記", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "未施工", "車位": "無車位", "門牌地址": "松江路252巷10號3樓" },
      { "戶別": "3B-3樓", "所有權人": "張儷瑋", "居住人": "尚未登記", "裝修公司": "尚未登記", "裝修人電話": "尚未登記", "開工日": "尚未登記", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "未施工", "車位": "無車位", "門牌地址": "松江路252巷10號3樓之1" },
      { "戶別": "3CD-3樓", "所有權人": "杜啓斌", "居住人": "尚未登記", "裝修公司": "宜荷室內裝修", "裝修人電話": "02-2727677", "開工日": "2025/03/12", "預計完工": "2025-04-25", "驗退日期": "2025-07-17", "驗退狀態": "已驗收（7月17日)", "施工狀態": "已開工", "車位": "B2-10", "門牌地址": "松江路252巷10號3樓之2" },
      { "戶別": "3EF-3樓", "所有權人": "高慧雯", "居住人": "尚未登記", "裝修公司": "尚未登記", "裝修人電話": "尚未登記", "開工日": "尚未登記", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "未施工", "車位": "無車位", "門牌地址": "松江路252巷10號3樓之5" },
      { "戶別": "2A-2樓", "所有權人": "許郅玫", "居住人": "尚未登記", "裝修公司": "尚未登記", "裝修人電話": "尚未登記", "開工日": "尚未登記", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "未施工", "車位": "無車位", "門牌地址": "松江路252巷10號2樓" },
      { "戶別": "2B-2樓", "所有權人": "湯蕙如", "居住人": "尚未登記", "裝修公司": "尚未登記", "裝修人電話": "尚未登記", "開工日": "尚未登記", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "未施工", "車位": "無車位", "門牌地址": "松江路252巷10號2樓之1" },
      { "戶別": "2C-2樓", "所有權人": "黃翎鈞", "居住人": "尚未登記", "裝修公司": "尚未登記", "裝修人電話": "尚未登記", "開工日": "尚未登記", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "未施工", "車位": "無車位", "門牌地址": "松江路252巷10號2樓之2" },
      { "戶別": "2D-2樓", "所有權人": "郭純純", "居住人": "尚未登記", "裝修公司": "尚未登記", "裝修人電話": "尚未登記", "開工日": "尚未登記", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "未施工", "車位": "無車位", "門牌地址": "松江路252巷10號2樓之3" },
      { "戶別": "2E-2樓", "所有權人": "林梓聖", "居住人": "尚未登記", "裝修公司": "尚未登記", "裝修人電話": "尚未登記", "開工日": "尚未登記", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "未施工", "車位": "無車位", "門牌地址": "松江路252巷10號2樓之5" },
      { "戶別": "2F-2樓", "所有權人": "魏慶龍", "居住人": "尚未登記", "裝修公司": "顧紋如", "裝修人電話": "0983182182", "開工日": "2025/06/04", "預計完工": "2025-07-05", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "已開工", "車位": "無車位", "門牌地址": "松江路252巷10號2樓之6" },
      { "戶別": "1A-1樓", "所有權人": "之餘國際室內裝修工程有限公司", "居住人": "店面", "裝修公司": "尚未登記", "裝修人電話": "尚未登記", "開工日": "尚未登記", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "未施工", "車位": "B2/11", "門牌地址": "松江路252巷10號1樓" },
      { "戶別": "1B-1樓", "所有權人": "之餘國際室內裝修工程有限公司", "居住人": "店面", "裝修公司": "尚未登記", "裝修人電話": "尚未登記", "開工日": "尚未登記", "預計完工": "尚未登記", "驗退日期": "尚未登記", "驗退狀態": "未驗收", "施工狀態": "未施工", "車位": "B2-12", "門牌地址": "松江路252巷10號1樓" }
    ];

    // 將所有單元資料按樓層分組
    // Group all unit data by floor
    const floorUnits = allUnitData.reduce((acc, unit) => {
      const floorMatch = unit["戶別"].match(/(\d+)/);
      if (floorMatch) {
        const floor = floorMatch[1];
        if (!acc[floor]) {
          acc[floor] = [];
        }
        acc[floor].push(unit);
      }
      return acc;
    }, {});

    // 動態繪製樓層熱區
    // Dynamically draw floor hot zones
    const container = document.getElementById('bldgWrap');
    const overlay = document.getElementById('bldgOverlay');
    const N = 10;
    const stone_bottom_pct = 0.925;
    function drawFloors() {
      overlay.innerHTML = '';
      let H = container.offsetHeight;
      let stoneY = Math.round(H * stone_bottom_pct);
      let zone_1f_height = H - stoneY;
      let floor_high = stoneY / 9;
      let centers = [ Math.round(stoneY + zone_1f_height/2) ];
      let heights = [ Math.round(zone_1f_height) ];
      for(let i=0; i<9; i++) {
        centers.push( Math.round(stoneY - (i+0.5)*floor_high ) );
        heights.push(Math.round(floor_high));
      }
      for(let i=0; i<N; i++) {
        let center = centers[i];
        let height = heights[i];
        let top = Math.max(center - Math.floor(height/2), 0);
        let f = (i+1).toString();
        let zone = document.createElement('div');
        zone.className = 'floor-zone';
        zone.style.top = top + 'px';
        zone.style.height = height + 'px';
        zone.setAttribute('data-floor', f);
        zone.id = 'zone' + f;
        zone.onclick = function(){ showFloor(f); };
        overlay.appendChild(zone);

        let label = document.createElement('div');
        label.className = 'floor-label';
        label.style.top = (top + 8) + 'px';
        label.innerText = f + 'F';
        overlay.appendChild(label);
      }
      showFloor('10'); // 初始顯示10樓
      document.getElementById('zone10').classList.add('active');
    }
    
    window.addEventListener('resize', drawFloors);
    window.addEventListener('DOMContentLoaded', drawFloors);

    // 根據樓層顯示對應的住戶卡片
    // Display unit cards for the selected floor
    function showFloor(floor) {
      document.querySelectorAll('.floor-zone').forEach(z => z.classList.remove('active'));
      const activeZone = document.getElementById('zone' + floor);
      if (activeZone) {
        activeZone.classList.add('active');
      }

      document.getElementById('currentfloor').innerText = floor + " 樓";
      
      const unitsContainer = document.getElementById('floorunits');
      unitsContainer.innerHTML = ''; // 清空舊內容
      
      const units = floorUnits[floor];
      if (units && units.length > 0) {
        units.forEach(unit => {
          const unitCard = createUnitCard(unit);
          unitsContainer.appendChild(unitCard);
        });
      } else {
        unitsContainer.innerHTML = '<div style="padding: 10px;">此樓層無資料</div>';
      }
    }

    // 動態創建單個住戶卡片
    // Dynamically create a single unit card
    function createUnitCard(data) {
      const unitCard = document.createElement('div');
      unitCard.className = 'unit-card';
      
      // 根據狀態設定標籤顏色和文字
      // Set tag color and text based on status
      let statusText = '';
      let statusColor = '#bdbdbd'; // 預設為未施工
      
      const verificationStatus = data['驗退狀態'];
      const constructionStatus = data['施工狀態'];

      if (verificationStatus.includes('已驗收')) {
          // 如果驗退狀態包含「已驗收」，則顯示驗收日期
          // If the verification status contains '已驗收', show the verification date
          const dateMatch = verificationStatus.match(/\d+月\d+日/);
          statusText = dateMatch ? `已驗收(${dateMatch[0]})` : '已驗收';
          statusColor = '#4caf50'; // 綠色
      } else if (constructionStatus === '已開工') {
          statusText = '已開工';
          statusColor = '#fb8c00'; // 橘色
      } else {
          statusText = '未施工';
          statusColor = '#bdbdbd'; // 灰色
      }

      // 檢查車位欄位是否為 "無車位"
      // Check if the parking spot field is '無車位'
      const carRow = data['車位'] && data['車位'] !== '無車位' 
        ? `<div class='row'>車位：${data['車位']}</div>` 
        : '';

      unitCard.innerHTML = `
        <div class="status-tag" style="background:${statusColor}">${statusText}</div>
        <div class="unit-header">${data['戶別']}</div>
        <div class="owner-label">所有權人：${data['所有權人']}</div>
        <div class="resident-label">居住人：${data['居住人']}</div>
        ${carRow}
        <div class="row">狀態：${data['驗退狀態']}</div>
        <button class="toggle-btn">查看詳細</button>
        <div class="details-wrap">
          <div class="details">
            <div class="row">裝修公司：${data['裝修公司']}</div>
            <div class="row">裝修人電話：${data['裝修人電話']}</div>
            <div class="row">開工日：${data['開工日']}</div>
            <div class="row">預計完工：${data['預計完工']}</div>
            <div class="row">驗退日期：${data['驗退日期']}</div>
            <div class="row">門牌地址：${data['門牌地址']}</div>
          </div>
        </div>
      `;
      
      // 添加事件監聽器來處理詳細資訊的開合
      // Add event listener to handle details toggle
      unitCard.querySelector('.toggle-btn').addEventListener('click', function() {
        toggleDetails(this);
      });
      
      return unitCard;
    }

    // 展開/收合詳細資訊
    // Toggle details section
    function toggleDetails(btn) {
      const detailsWrap = btn.nextElementSibling;
      const isExpanded = detailsWrap.classList.toggle('expanded');
      btn.innerText = isExpanded ? '收合詳細' : '查看詳細';
    }

    // 3D 粒子背景效果
    // 3D particle background effect
    function threejsBackground() {
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0x000000, 0);
        document.getElementById('three-bg').appendChild(renderer.domElement);

        // 粒子
        const particleCount = 5000;
        const geometry = new THREE.BufferGeometry();
        const positions = [];
        const colors = [];
        const color = new THREE.Color();
        const material = new THREE.PointsMaterial({
            size: 0.8,
            vertexColors: true,
            blending: THREE.AdditiveBlending,
            transparent: true,
            opacity: 0.6
        });

        for (let i = 0; i < particleCount; i++) {
            const x = (Math.random() - 0.5) * 2000;
            const y = (Math.random() - 0.5) * 2000;
            const z = (Math.random() - 0.5) * 2000;
            positions.push(x, y, z);
            color.setHSL(Math.random(), 1.0, 0.5);
            colors.push(color.r, color.g, color.b);
        }

        geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
        geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));

        const particles = new THREE.Points(geometry, material);
        scene.add(particles);

        camera.position.z = 5;

        // 滑鼠互動
        const mouse = new THREE.Vector2();
        document.addEventListener('mousemove', (event) => {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
        });

        function animate() {
            requestAnimationFrame(animate);

            // 粒子旋轉
            particles.rotation.x += 0.0005;
            particles.rotation.y += 0.001;

            // 相機跟隨滑鼠
            camera.position.x += (mouse.x * 2 - camera.position.x) * 0.05;
            camera.position.y += (-mouse.y * 2 - camera.position.y) * 0.05;
            camera.lookAt(scene.position);
            
            renderer.render(scene, camera);
        }
        animate();
        
        // 確保視窗大小改變時，背景也能適應
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    }

    // 頁面載入時啟動
    window.addEventListener('load', () => {
      drawFloors();
      threejsBackground();
    });
  </script>
</body>
</html>